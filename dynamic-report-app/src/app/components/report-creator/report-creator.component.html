<p>report-creator works!</p>
<div>
  <h2>Dynamic Report Creator</h2>

  <!-- Display errors -->
  <div *ngIf="error" class="error">
    Error: {{ error }}
  </div>

  <!-- Table selection -->
  <div>
    <label>Select Table:&nbsp;</label>
    <select (change)="onTableSelect($event)">
      <option value="">--Select--</option>
      <option *ngFor="let table of tables" [value]="table.table_name">
        {{ table.table_name }}
      </option>
    </select>
  </div>

  <!-- Display available columns -->
  <div *ngIf="columns.length > 0">
    <p><strong>Available Columns:</strong> {{ columns  }}</p>
  </div>

  <!-- Angular Material Tab Group to separate Filter, Sort By, and Group By -->
  <mat-tab-group *ngIf="columns.length > 0">
    <!-- Filter Tab -->
    <mat-tab label="Filter">
      <div class="tab-content" style="padding: 16px;">
        <div>
          <label>Column:&nbsp;</label>
          <select [(ngModel)]="newFilter.column">
            <option value="">--Select Column--</option>
            <option *ngFor="let col of columns" [value]="col.column_name">
              {{ col.column_name }}
            </option>
          </select>
        </div>
        <div>
          <label>Operator:&nbsp;</label>
          <select [(ngModel)]="newFilter.operator">
            <option value="=">=</option>
            <option value="<>">&lt;&gt;</option>
            <option value=">">&gt;</option>
            <option value="<">&lt;</option>
            <option value="LIKE">LIKE</option>
          </select>
        </div>
        <div>
          <label>Value:&nbsp;</label>
          <input type="text" [(ngModel)]="newFilter.value" />
        </div>
        <button (click)="addFilter()">Add Filter</button>
        <!-- Display added filters -->
        <ul>
          <li *ngFor="let filter of reportConfig.filters; let i = index">
            {{ filter.column }} {{ filter.operator }} {{ filter.value }}
            <button (click)="removeFilter(i)">Remove</button>
          </li>
        </ul>
      </div>
    </mat-tab>

    <!-- Sort By Tab -->
    <mat-tab label="Sort By">
      <div class="tab-content" style="padding: 16px;">
        <div>
          <label>Column:&nbsp;</label>
          <select [(ngModel)]="newSort.column">
            <option value="">--Select Column--</option>
            <option *ngFor="let col of columns" [value]="col.column_name">
              {{ col.column_name }}
            </option>
          </select>
        </div>
        <div>
          <label>Order:&nbsp;</label>
          <select [(ngModel)]="newSort.order">
            <option value="ASC">Ascending</option>
            <option value="DESC">Descending</option>
          </select>
        </div>
        <button (click)="addSort()">Add Sort</button>
        <!-- Display added sort options -->
        <ul>
          <li *ngFor="let sort of reportConfig.sortBy; let i = index">
            {{ sort.column }} {{ sort.order }}
            <button (click)="removeSort(i)">Remove</button>
          </li>
        </ul>
      </div>
    </mat-tab>

    <!-- Group By Tab -->
    <mat-tab label="Group By">
      <div class="tab-content" style="padding: 16px;">
        <div>
          <label>Columns (comma separated):&nbsp;</label>
          <input type="text" placeholder="e.g., col1, col2" [(ngModel)]="reportConfig.groupByString"
                 />
        </div>
        <div>
          <p><strong>Selected Group By:</strong> {{ reportConfig.groupBy }}</p>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>

  <!-- Actions to Preview and Save Report -->
  <div style="margin-top: 20px;">
    <button (click)="executeReport()">Preview Report</button>
    <br /><br />
    <label>Report Name:&nbsp;</label>
    <input type="text" [(ngModel)]="reportName" placeholder="Enter report name" />
    <button (click)="saveReport()">Save Report</button>
  </div>

  <!-- Report Preview Section -->
  <div *ngIf="queryResult.length > 0">
    <h3>Report Preview</h3>
    <table border="1">
      <tr>
        <th *ngFor="let col of columns">{{ col.column_name }}</th>
      </tr>
      <tr *ngFor="let row of queryResult">
        <td *ngFor="let col of columns">{{ row[col.column_name] }}</td>
      </tr>
    </table>
  </div>

  <!-- Saved Reports Section -->
  <div style="margin-top: 20px;">
    <h3>Saved Reports</h3>
    <table border="1">
      <tr>
        <th>ID</th>
        <th>Report Name</th>
        <th>Action</th>
      </tr>
      <tr *ngFor="let report of savedReports">
        <td>{{ report.id }}</td>
        <td>{{ report.report_name }}</td>
        <td>
            <!-- <button (click)="loadReport(report.id)">Load</button> -->
        </td>
      </tr>
    </table>
  </div>
</div>
